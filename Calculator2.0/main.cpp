/*可以计算带括号的表达式，但是只能计算十以内的整数*/

#include <iostream>
#include <stack>

using namespace std;

double inStack();   //核心函数，将操作符有序的入栈计算， 最后返回结果
void calculate(stack<char>& Ope, stack<int>& Num);  //用来计算加减乘除, 结果放在数字栈顶
int priority(char ope_);   //用来计算操作符的优先级

int main() {
	double result;   //最后的结果

	cout << "请输入：\n";
	result = inStack();   //将缓冲区的操作符和数字压入栈 

	cout << "结果是：\n" << result;

	return 0;
}

double inStack() {
	stack<char> Ope;
	stack<int> Num;
	char ch;

	while (1) {
		cin >> ch;   //输入一个字符
		if(ch>='0'&&ch<='9') Num.push(ch-'0');   //数字直接入栈
		else if (ch == '=') {
			while (!Ope.empty()) calculate(Ope, Num); //如果符号栈不空，就一直计算
			return Num.top();  //如果是等号且符号栈顶为空，就返回数字栈顶元素
		}
		else if (ch == '('||Ope.empty()) Ope.push(ch);    //如果符号是左括号或符号栈为空直接压入
		else if (ch == ')') {  //如果是右括号
			while(Ope.top()!='(') calculate(Ope, Num); //一直计算完括号里的
			Ope.pop();  //左括号出栈
		}
		else if (priority(Ope.top()) >= priority(ch)) {  //如果栈顶符号的优先级大于等于当前
			calculate(Ope, Num);   //计算结果压入数字栈,取出当前栈顶
			Ope.push(ch);  //压入当前符号
		}
		else Ope.push(ch);  //否则就压入符号栈
	}
}

void calculate(stack<char>& Ope, stack<int>& Num) {
	int a, b;
	a = Num.top(); Num.pop();
	b = Num.top(); Num.pop();

	if (Ope.top() == '+') Num.push(b + a);
	else if (Ope.top() == '-') Num.push(b - a);
	else if (Ope.top() == '*') Num.push(b * a);
	else if (Ope.top() == '/') Num.push(b / a);

	Ope.pop();
}

int priority(char ope_) {
	if (ope_ == '(') return 0;
	else if (ope_ == '+' || ope_ == '-') return 1;
	else if (ope_ == '*' || ope_ == '/') return 2;
}